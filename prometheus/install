1)kubernetese helm ile persistant volume ile install edilmesi
loki:
  persistence:
    enabled: true
    storageClassName: "huawei-sc"
    size: 50Gi

  # Güvenlik ayarlarını Huawei ile tam uyumlu yapalım
  securityContext:
    fsGroup: 0
    runAsGroup: 0
    runAsUser: 0
    runAsNonRoot: false

  # Config hatasını ve yetkiyi kökten çözen yapılandırma
  config:
    common:
      path_prefix: /data
      storage:
        filesystem:
          chunks_directory: /data/chunks
          rules_directory: /data/rules
      replication_factor: 1
      ring:
        instance_addr: 127.0.0.1
        kvstore:
          store: inmemory
    storage_config:
      boltdb_shipper:
        active_index_directory: /data/index
        cache_location: /data/index_cache
        resync_interval: 5s

promtail:
  enabled: true

2) helm install loki grafana/loki-stack -n monitoring -f loki-values.yaml
1)vim prom-values.yaml
prometheus:
  prometheusSpec:
    # 1. Yöntem: Güvenlik ayarlarını Huawei uyumlu hale getir
    securityContext:
      runAsUser: 0
      runAsGroup: 0
      fsGroup: 0
      runAsNonRoot: false

    # 2. Yöntem: Mevcut dizin yetkilerini zorla değiştir (Opsiyonel ama işe yarar)
    initContainers:
      - name: init-chown-data
        image: busybox:latest
        command: ["chown", "-R", "1000:2000", "/prometheus"]
        volumeMounts:
          - name: prometheus-prometheus-kube-prometheus-prometheus-db
            mountPath: /prometheus

    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: "huawei-sc"
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi
2)helm upgrade prometheus prometheus-community/kube-prometheus-stack -n monitoring -f prom-values.yaml
